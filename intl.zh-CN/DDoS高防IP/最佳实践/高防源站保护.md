# 高防源站保护 {#concept_40525_zh .concept}

不同场景下高防源站保护的方式和原理不同。 请参考本文介绍的场景，选择适合您当前架构的方式进行配置。

**说明：** 配置源站保护，并不能防止没有经过高防的流量对源站直接发起DDoS攻击（甚至将源站打进黑洞）。配置高防源站保护只针对小流量CC攻击以及Web攻击有防护意义，对于防护大规模DDoS攻击的意义并不大。

## 网站防护（七层转发） {#section_xs3_dyp_fgb .section}

-   **高防IP \> ECS或不在阿里云的源站**

    在这种架构下，访问ECS、源站流量的源IP都会变成高防的[回源IP](intl.zh-CN/DDoS高防IP/快速入门/防护网站业务/步骤2：放行回源IP段.md#)。

    您可以使用源站上的安全软件（如iptables、防火墙等），只放行高防的回源IP，同时拦截其他所有来自非高防回源段的IP地址。

-   **高防IP \> SLB \> ECS**

    在这种架构下，访问ECS流量的IP变成SLB的IP。

    建议您通过SLB的白名单功能来只允许高防IP访问SLB。

-   **高防IP \> WAF/CDN \> ECS**

    在这种架构下，访问ECS流量的IP会变成WAF或者CDN的IP，原理和SLB相同。

    如果条件允许，您可以在WAF、CDN配置相应策略，源站的策略则针对WAF或CDN的回源IP来配置。


## 非网站防护（四层转发） { .section}

源站保护对四层转发无效。即使配置源站保护，如果攻击绕过高防IP直接攻击源站，还是会将源站的上游链路堵死或者引发黑洞，无法起到源站保护的效果。

## 设置ECS安全组保护源站 { .section}

参照以下步骤，设置ECS安全组。

1.  登录到[云服务器 ECS 控制台](https://ecs.console.aliyun.com)。
2.  从左侧导航栏选择**安全组**，并选择目标区域（安全组只能应用于相同区域下的ECS），单击**创建安全组**。
3.  填写安全组名称、描述等信息，单击**确定**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/79580/154710609235043_zh-CN.png)

4.  在新创建的安全组的操作列下，单击**配置规则**进入规则编辑页面，单击**添加安全组规则**。
5.  假设高防IP服务的回源IP段为`1.1.1.0/24`，您可以按如下示例添加安全组规则。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/79580/154710609235044_zh-CN.png)

    **说明：** 

    -   授权对象一次可添加一个IP或IP段。如果有多个IP或IP段，可通过添加多个规则实现。
    -   优先级高的规则，会优先匹配。
6.  按照示例中放行全部高防回源IP段后，再添加一条优先级较低的规则拒绝所有IP访问。
7.  配置完安全组规则后，找到需要放行高防回源IP的ECS实例，选择本实例安全组，单击**加入安全组**，将ECS实例加入该安全组。

